<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Monaco Editor 示例</title>
    <script src="/component/monaco/js/loader.js"></script>
</head>

<body>
    <form class="layui-form">
        <div id="editor-container" name="dockerfile" style="height: 300px;"></div>
        <textarea name="dockerfile" style="display: none;"></textarea>
    </form>
    <script>
        layui.use(['layer', 'form'], function () {
            var $ = layui.jquery,
                layer = layui.layer,
                form = layui.form;

            var editor;
            

            require.config({ paths: { 'vs': '/component/monaco' } });
            require(['vs/editor/editor.main'], function () {
                editor = monaco.editor.create(document.getElementById('editor-container'), {
                    language: 'dockerfile'
                });

                monaco.languages.registerCompletionItemProvider('dockerfile', {
                    provideCompletionItems: function (model, position) {
                        var textUntilPosition = model.getValueInRange({
                            startLineNumber: 1,
                            startColumn: 1,
                            endLineNumber: position.lineNumber,
                            endColumn: position.column
                        });

                        // 调用 DeepSeek API 获取补全建议
                        return fetch('https://api.deepseek.com/v1/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer sk-3754cd2240ae4afba64ec51aacd3c959'
                            },
                            body: JSON.stringify({
                                prompt: textUntilPosition,
                                max_tokens: 50,
                                model: "deepseek-r1" // 确保包含 model 字段
                            })
                        })
                            .then(response => response.json())
                            .then(data => {
                                return {
                                    suggestions: data.choices.map(choice => ({
                                        label: choice.text.trim(),
                                        kind: monaco.languages.CompletionItemKind.Text,
                                        insertText: choice.text.trim()
                                    }))
                                };
                            });
                    }
                });
                
                
            });

        });
    </script>
</body>

</html>